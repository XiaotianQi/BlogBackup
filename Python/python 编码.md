**概述**

在电脑和电信领域中，**字符**（Character）是一个信息单位。对使用字母系统或音节文字等自然语言，它大约对应为一个音位、类音位的单位或符号。简单来讲就是一个汉字、假名、韩文字……，或是一个英文、其他西方语言的字母。字符的例子有：

* 字母、数字系统或标点符号。
* 另外有所谓控制字符的概念，它是指：并不对应到自然语言中的某个特定符号，而是对应到语言中一些用来处理文句的概念（类似排版）。例子为打印机或其它显示设备的命令，如 Enter 或 Tab。

电脑和通信设备会在表示字符时，会使用**字符编码**。是指将一个字符对应为某个东西。传统上，是代表整数的比特序列，如此，则可透过网络来传输，同时亦便于存储。两个常用的例子是 ASCII 和用于 Unicode 编码的 UTF-8。摩斯密码则是使用不定长度的电子脉冲的序列来表现字符。

在字符编码术语中，**码位**或称编码位置，即英文的 code point 或 code position，是组成码空间（或代码页）的数值。例如，ASCII 码包含 128个 码位，扩展 ASCII 码包含 256 个码位，而 Unicode 包含 1,114,112 个码位。

Unicode，中文又称万国码、国际码、统一码、单一码，是计算机科学领域的业界标准。它整理、编码了世界上大部分的文字系统，使得电脑可以用更为简单的方式来呈现和处理文字。Unicode 为解决传统字符编码方案的局限而产生。很多传统的编码方式都有共同的问题，即容许电脑处理双语环境（通常使用拉丁字母以及其本地语言），但却无法同时支持多语言环境（指可同时处理多种语言混合的情况）。在文字处理方面，统一码为每一个字符而非字形定义唯一的代码（即一个整数）。换句话说，统一码以一种抽象的方式（即数字）来处理字符，并将视觉上的演绎工作（例如字体大小、外观形状、字体形态、文体等）留给其他软件来处理，例如网页浏览器或是文字处理器。

Unicode 标准描述了如何使用码位(code points)表示字符。一个 Unicode 字符串是一组码点组成的序列，它们是从 0 到 0x10FFFF (十进制:1,114,111)的数字。

Unicode 的实现方式不同于编码方式。一个字符的 Unicode 编码确定。但是在实际传输过程中，由于不同系统平台的设计不一定一致，以及出于节省空间的目的，对 Unicode 编码的实现方式有所不同。Unicode 的实现方式称为 Unicode 转换格式（Unicode Transformation Format，简称为**UTF**）。

***

**编码 & 编码**

在内存中，码点序列表示为一组**码元(code units)**，然后将码元映射到 8 位字节。 将 Unicode 字符串转换为字节的规则称为**字符编码(character encoding)**，或者简称为**编码(encoding)**。 

编码就是将字符串转换成字节码，涉及到字符串的内部表示。

解码就是将字节码转换为字符串，将比特位显示成字符。

***

**UTF**

**Unicode 解决了字符和二进制的对应关系，但是使用 unicode 表示一个字符，太浪费空间。**例如：利用 unicode 表示 `Python`需要 12 个字节才能表示，比原来ASCII 表示增加了 1 倍。

**为了解决存储和网络传输的问题，出现了Unicode Transformation Format，学术名 UTF，即：对unicode中的进行转换，以便于在存储和网络传输时可以节省空间！**

* UTF-8：使用1、2、3、4个字节表示所有字符；优先使用 1 个字符、无法满足则使增加一个字节，最多 4 个字节。英文占 1 个字节、欧洲语系占 2 个、东亚占 3 个，其它及特殊字符占 4 个

* UTF-16：使用2、4个字节表示所有字符；优先使用 2 个字节，否则使用 4 个字节表示。

* UTF-32：使用 4 个字节表示所有字符；

UTF 是为 unicode 编码设计的一种在存储和传输时节省空间的编码方案。

无论以什么编码在内存里显示字符，存到硬盘上都是 2 进制。存到硬盘上时是以何种编码存的，再从硬盘上读出来时，就必须以何种编码读，否则无法正确读取。

***

**Python’s Unicode 支持**

在 python2 中，使用 unicode 类型作为编码的基础类型。即

```text
     decode              encode
str ---------> unicode --------->str
```

```python
u = u'中文' 				# 显示指定 unicode 类型对象u
str = u.encode('utf-8')  # 以utf-8编码对unicode对像进行编码
u = str.decode('utf-8')  # 如果以utf-8的编码对str进行解码
```

在 python3 中，使用 unicode 字符的字符串类型 `str`，Unicode 字符串以 code points 序列的形式存储在内部。而编码后的变为了字节类型 `bytes`，但是 `bytes.decode()` 与 `str.encode()` 函数的使用方法不变：

```text
      decode              encode
bytes ------> str(unicode)------>bytes
```

```python
u = '中文'					# 类型:str,  指定字符串类型对象u
string = u.encode('utf-8')	 # 类型:bytes,以utf-8编码对u进行编码
u1 = string.decode('utf-8')  # 类型:str,	以utf-8编码对字符串str进行解码
```

当输入 `str` 时，它使用几种标准方案之一进行编码(encode)，以便字节序列可以被解码(decode)为相同的文本字符串。

***

**python2 与 python3 之间编码区别**

字符串可以认为有两种状态，即文本状态和字节（二进制）状态。Python2 和 Python3 中的两种字符类型都分别对应这两种状态，然后相互之间进行编解码转化。

在 Python2 中，str 和 unicode 都有 `encode()` 和 `decode()` 方法。但是不建议对 str 使用 `encode()`，对 unicode 使用 `decode()`, 这是 Python2 设计上的缺陷。Python3 则进行了优化，str 只有一个 `encode()`方法将字符串转化为一个字节码，而且 bytes 也只有一个 `decode()`方法将字节码转化为一个文本字符串。

Python2 的 str 和 unicode 都是 basestring 的子类，所以两者可以直接进行拼接操作。而 Python3 中的 bytes 和 str 是两个独立的类型，两者不能进行拼接。

Python2 中，普通的、用引号括起来的字符，就是 str；此时字符串的编码类型，对应着 Python 文件本身保存为何种编码有关，最常见的 Windows 平台中，默认用的是 GBK。Python3 中，被单引号或双引号括起来的字符串，就已经是 Unicode 类型的 str 了。对于 str 为何种编码，有一些前提：

- Python 文件开始已经声明对应的编码
- Python 文件本身的确是使用该编码保存的
- 两者的编码类型要一样（比如都是 UTF-8 或者都是 GBK 等）

这样 Python 解析器才能正确的把文本解析为对应编码的 str。

总体来说，在 Python3 中，字符编码问题得到了极大的优化，不再像 Python2 那么头疼。在 Python3 中，文本总是 Unicode, 由 str 类型进行表示，二进制数据使用 bytes 进行表示，不会将 str 与 bytes 偷偷的混在一起，使得两者的区别更加明显。这意味着，只要用 python3，无论你的程序是以哪种编码开发的，都可以在全球各国电脑上正常显示。

***

**编码问题**

出现各种编码问题，无非是哪里的编码设置出错了。常见编码错误的原因有：

* Python 解释器的默认编码
* Python 源文件文件编码
* Terminal 使用的编码
* 操作系统的语言设置 

***

参考：

[Python 编码](https://www.zhihu.com/question/31833164)，冯若航、xlzd、Coldwings 的回答

[Python2 与 Python3 的编码对比](http://kuanghy.github.io/2016/10/15/encoding-python2-vs-python3)，Huoty's Blog